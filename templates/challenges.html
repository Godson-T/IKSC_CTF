{% extends "base.html" %}

{% block content %}
<div class="container py-4">
    <h2 class="text-center mb-5 fw-bold text-primary">Challenges</h2>
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
    {% for c in challenges %}
    <div class="col">
        <div id="challenge-{{ c['id'] }}" class="card h-100
            {% if c['id'] in solved_ids %}.bg-success bg-gradient{% else %}bg-secondary bg-gradient{% endif %}">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>{{ c['title'] }}</span>
                <span class="badge {% if c['id'] in solved_ids %}bg-light{% else %}bg-dark{% endif %}">
                    {% if c['id'] in solved_ids %}✅ Solved!{% else %}{{ c['points'] }} pts{% endif %}
                </span>
            </div>
            <div class="card-body d-flex flex-column">
                <p>{{ c['description'] }}</p>
                {% if c['id'] not in solved_ids %}
                <form method="POST" action="/submit_flag/{{ c['id'] }}" class="mt-auto">
                    <input class="form-control mb-2" name="flag" placeholder="Enter flag">
                    <button class="btn btn-primary w-100" type="submit">Submit</button>
                </form>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

</div>

{% if flash_id %}
<script>
    const flashCard = document.getElementById('challenge-{{ flash_id }}');
    if(flashCard){
        flashCard.classList.add('flash-solved');
        setTimeout(() => {
            flashCard.classList.remove('flash-solved');
            flashCard.classList.remove('bg-warning','text-dark');
            flashCard.classList.add('bg-success','text-light');
            const badge = flashCard.querySelector('.badge');
            if(badge){
                badge.textContent = "✅ Solved!";
                badge.classList.remove('bg-dark','text-light');
                badge.classList.add('bg-light','text-dark');
            }
        }, 600);
    }
</script>
{% endif %}
{% endblock %}
